import{j as e,$ as W,a0 as k,a1 as ee,s as S,A as $,M as q,m as G,n as Z,p as J,r as K,ae as te}from"./chakra-594c63ee.js";import{c as v,j as C,d as A,D as P,ah as _,z as w,A as y,t as Q,N as I,q as ne,v as se,aj as B,ak as U,y as N,n as F,al as ae,am as ie,an as re,ao as oe,p as H}from"./index-0d111ac7.js";import{b as c}from"./react-2c0b8364.js";import{b as le}from"./graph-1424c961.js";import{d as ce,e as de,f as pe}from"./change-types-3c7e98bb.js";import{s as X}from"./stations-12179c83.js";import{u as V,e as ue}from"./clipboard-c291d56a.js";import{m as he}from"./misc-nodes-67200cac.js";function ge(){const{t:n}=v(),i=C(),{selected:a}=A(t=>t.runtime),o=c.useRef(window.graph),s=t=>{i(P()),i(_(t))};return e.jsxs(W,{children:[e.jsxs(k,{as:"h5",size:"sm",children:[n("panel.details.selected")," ",a.length]}),e.jsx(ee,{m:"var(--chakra-space-1)",children:a.map(t=>{const r=o.current.getNodeAttributes(t),p=r.type,l=t.startsWith("stn")?r[p].names.join("/"):p;return e.jsx(S,{width:"100%",size:"sm",variant:"solid",onClick:()=>s(t),overflow:"hidden",maxW:"270",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:l},t)})})]})}function me(){const{t:n}=v(),i=C(),a=c.useCallback(()=>{i(w()),i(y(r.current.export()))},[i,w,y]),{selected:o,theme:s}=A(f=>f.runtime),t=o.at(0),r=c.useRef(window.graph),[p,l]=c.useState(!1),h=c.useRef(null),d=Object.fromEntries(Object.entries(Q).map(([f,M])=>[f,n(M.metadata.displayName).toString()])),[u,g]=c.useState(r.current.getEdgeAttribute(t,"type")),[m,x]=c.useState(void 0),j=Object.fromEntries(Object.entries(I).map(([f,M])=>[f,n(M.metadata.displayName).toString()])),[b,z]=c.useState(r.current.getEdgeAttribute(t,"style")),[T,O]=c.useState(void 0),E=Object.values(ne).filter(f=>!I[b].metadata.supportLinePathType.includes(f)),R=Object.values(se).filter(f=>!I[f].metadata.supportLinePathType.includes(u)),L=()=>{m&&(ce(r.current,t,m),g(r.current.getEdgeAttribute(t,"type")),a())},Y=()=>{T&&(de(r.current,t,T,s),z(r.current.getEdgeAttribute(t,"style")),a())},D=f=>{f&&(m?(L(),x(void 0)):T&&(Y(),O(void 0))),l(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(B,{label:n("panel.details.info.linePathType"),minW:"276",children:e.jsx(U,{options:d,disabledOptions:E,defaultValue:u,value:u,onChange:({target:{value:f}})=>{x(f),l(!0)}})}),e.jsx(B,{label:n("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(U,{options:j,disabledOptions:R,defaultValue:b,value:b,onChange:({target:{value:f}})=>{O(f),l(!0)}})}),e.jsx($,{isOpen:p,leastDestructiveRef:h,onClose:()=>D(!1),children:e.jsx(q,{children:e.jsxs(G,{children:[e.jsx(Z,{children:n("warning")}),e.jsx(J,{children:n("panel.details.changeLineTypeContent")}),e.jsxs(K,{children:[e.jsx(S,{ref:h,onClick:()=>D(!1),children:n("cancel")}),e.jsx(S,{ml:"2",colorScheme:"red",onClick:()=>D(!0),children:n("panel.details.changeType")})]})]})})})]})}function fe(){const{t:n}=v(),i=C(),a=c.useCallback(()=>{i(N()),i(y(t.current.export()))},[i,N,y]),{selected:o}=A(j=>j.runtime),s=o.at(0),t=c.useRef(window.graph),[r,p]=c.useState(!1),l=c.useRef(null),[h,d]=c.useState(void 0),u=t.current.getNodeAttribute(s,"type"),g=Object.fromEntries(Object.entries(X).map(([j,b])=>[j,n(b.metadata.displayName).toString()])),m=()=>{h&&(pe(t.current,s,h),a())},x=j=>{j&&m(),d(void 0),p(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(B,{label:n("panel.details.info.stationType"),minW:"276",children:e.jsx(U,{options:g,disabledOptions:[u],value:u,onChange:({target:{value:j}})=>{d(j),p(!0)}})}),e.jsx($,{isOpen:r,leastDestructiveRef:l,onClose:()=>x(!1),children:e.jsx(q,{children:e.jsxs(G,{children:[e.jsx(Z,{children:n("warning")}),e.jsx(J,{children:n("panel.details.changeStationTypeContent")}),e.jsxs(K,{children:[e.jsx(S,{ref:l,onClick:()=>x(!1),children:n("cancel")}),e.jsx(S,{ml:"2",colorScheme:"red",onClick:()=>x(!0),children:n("panel.details.changeType")})]})]})})})]})}function xe(){const{t:n}=v(),i=C(),a=c.useCallback(()=>{i(N()),i(w()),i(y(t.current.export()))},[i,w,y]),{selected:o}=A(l=>l.runtime),s=o.at(0),t=c.useRef(window.graph),r=l=>{const h=Math.min(Math.max(l,-5),5);t.current.hasNode(s)&&t.current.setNodeAttribute(s,"zIndex",h),t.current.hasEdge(s)&&t.current.setEdgeAttribute(s,"zIndex",h),a()},p=[{type:"input",label:n("panel.details.info.id"),value:o.length>0?o.join(", "):"undefined",minW:276},{type:"select",label:n("panel.details.info.zIndex"),value:s?t.current.hasNode(s)?t.current.getNodeAttribute(s,"zIndex"):t.current.hasEdge(s)?t.current.getEdgeAttribute(s,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:11},(l,h)=>[h-5,(h-5).toString()])),onChange:l=>r(Number(l))}];return o.length===0||o.length>1&&p.push({type:"input",label:n("panel.details.info.type"),value:"multiple selection",minW:276}),e.jsxs(W,{p:1,children:[e.jsx(k,{as:"h5",size:"sm",children:n("panel.details.info.title")}),e.jsx(F,{fields:p,minW:130}),o.length===1&&s.startsWith("stn")&&t.current.hasNode(s)&&e.jsx(fe,{}),o.length===1&&s.startsWith("line")&&t.current.hasEdge(s)&&e.jsx(me,{}),o.length>1&&e.jsx(ge,{})]})}function ye(){const{t:n}=v(),i=C(),{selected:a}=A(b=>b.runtime),o=a.at(0),s=c.useRef(window.graph),[t,r]=c.useState("undefined"),[p,l]=c.useState("undefined"),[h,d]=c.useState("undefined"),[u,g]=c.useState("undefined");c.useEffect(()=>{var b,z,T,O;if(o!=null&&o.startsWith("line")){const[E,R]=s.current.extremities(o);if(r(E),l(R),E.startsWith("stn")){const L=s.current.getNodeAttribute(E,"type");d((z=(b=s.current.getNodeAttribute(E,L))==null?void 0:b.names.at(0))!=null?z:"undefined")}if(R.startsWith("stn")){const L=s.current.getNodeAttribute(R,"type");g((O=(T=s.current.getNodeAttribute(R,L))==null?void 0:T.names.at(0))!=null?O:"undefined")}}},[a]);const m=V(()=>{i(P()),i(_(t))}),x=V(()=>{i(P()),i(_(p))}),j=[{type:"custom",label:n("panel.details.lineExtremities.source"),component:e.jsx(S,{flex:1,size:"sm",variant:"link",onClick:m,children:t})},{type:"custom",label:n("panel.details.lineExtremities.target"),component:e.jsx(S,{flex:1,size:"sm",variant:"link",onClick:x,children:p})},{type:"input",label:n("panel.details.lineExtremities.sourceName"),value:h},{type:"input",label:n("panel.details.lineExtremities.targetName"),value:u}];return e.jsxs(W,{p:1,children:[e.jsx(k,{as:"h5",size:"sm",children:n("panel.details.lineExtremities.title")}),e.jsx(F,{fields:j,minW:130})]})}function je(){const{t:n}=v(),i=C(),a=c.useCallback(()=>{i(N()),i(w()),i(y(r.current.export()))},[i,N,w,y]),{selected:o,refresh:{nodes:s}}=A(d=>d.runtime),t=o.at(0),r=c.useRef(window.graph),[p,l]=c.useState({x:0,y:0});c.useEffect(()=>{if(t!=null&&t.startsWith("stn")||t!=null&&t.startsWith("misc_node_")){const d=r.current.getNodeAttribute(t,"x"),u=r.current.getNodeAttribute(t,"y");l({x:d,y:u})}},[s,o]);const h=[{type:"input",label:n("panel.details.nodePosition.pos.x"),value:p.x.toString(),validator:d=>!Number.isNaN(d),onChange:d=>{r.current.mergeNodeAttributes(t,{x:Number(d)}),a()}},{type:"input",label:n("panel.details.nodePosition.pos.y"),value:p.y.toString(),validator:d=>!Number.isNaN(d),onChange:d=>{r.current.mergeNodeAttributes(t,{y:Number(d)}),a()}}];return e.jsxs(W,{p:1,children:[e.jsx(k,{as:"h5",size:"sm",children:n("panel.details.nodePosition.title")}),e.jsx(F,{fields:h,minW:130})]})}const be={...X,...he},Se=()=>{var p;const n=C(),{selected:i}=A(l=>l.runtime),a=i.at(0),o=window.graph.getNodeAttribute(a,"type"),s=be[o].attrsComponent,t=(p=window.graph.getNodeAttribute(a,o))!=null?p:{},r=(l,h)=>{const d=window.graph.getNodeAttribute(l,"type");window.graph.mergeNodeAttributes(l,{[d]:h}),n(N()),n(y(window.graph.export()))};return s&&e.jsx(s,{id:a,attrs:t,handleAttrsUpdate:r})},we=()=>{var u,g;const n=C(),{selected:i}=A(m=>m.runtime),a=i.at(0),o=window.graph.getEdgeAttribute(a,"type"),s=(u=window.graph.getEdgeAttribute(a,o))!=null?u:{},t=Q[o].attrsComponent,r=window.graph.getEdgeAttribute(a,"style"),p=(g=window.graph.getEdgeAttribute(a,r))!=null?g:{},l=I[r].attrsComponent,h=(m,x)=>{window.graph.mergeEdgeAttributes(m,{[o]:x}),n(w()),n(y(window.graph.export()))},d=(m,x)=>{window.graph.mergeEdgeAttributes(m,{[r]:x}),n(w()),n(y(window.graph.export()))};return e.jsxs(e.Fragment,{children:[t&&e.jsx(t,{id:a,attrs:s,handleAttrsUpdate:h}),l&&e.jsx(l,{id:a,attrs:p,handleAttrsUpdate:d})]})},Le=()=>{const{t:n}=v(),i=C(),a=c.useRef(window.graph),o=c.useCallback(()=>{i(N()),i(w()),i(y(a.current.export()))},[i,N,w,y]),{selected:s,mode:t}=A(u=>u.runtime),r=s.at(0),p=()=>i(P()),l=u=>{const g=structuredClone(a.current.getNodeAttributes(u));g.x+=50,g.y+=50;const m=u.startsWith("stn")?`stn_${H(10)}`:`misc_node_${H(10)}`;a.current.addNode(m,g),i(N()),i(y(a.current.export()))},h=u=>{const g=new Set(u),m=le(a.current,g),x=ue(a.current,g,new Set(m));navigator.clipboard.writeText(x)},d=u=>{i(P()),u.forEach(g=>{a.current.hasNode(g)?a.current.dropNode(g):a.current.hasEdge(g)&&a.current.dropEdge(g)}),o()};return e.jsxs(ae,{isOpen:s.length>0&&!t.startsWith("line"),width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(ie,{onClose:p,children:n("panel.details.header")}),e.jsxs(re,{children:[e.jsx(xe,{}),s.length===1&&a.current.hasNode(r)&&e.jsx(je,{}),s.length===1&&a.current.hasEdge(r)&&e.jsx(ye,{}),s.length===1&&e.jsxs(W,{p:1,children:[e.jsx(k,{as:"h5",size:"sm",children:n("panel.details.specificAttrsTitle")}),window.graph.hasNode(r)&&e.jsx(Se,{}),window.graph.hasEdge(r)&&e.jsx(we,{})]})]}),e.jsx(oe,{children:e.jsxs(te,{children:[s.length===1&&a.current.hasNode(s.at(0))&&e.jsx(S,{size:"sm",variant:"outline",onClick:()=>l(s.at(0)),children:n("panel.details.footer.duplicate")}),e.jsx(S,{size:"sm",variant:"outline",onClick:()=>h(s),children:n("panel.details.footer.copy")}),e.jsx(S,{size:"sm",variant:"outline",onClick:()=>d(s),children:n("panel.details.footer.remove")})]})})]})};export{Le as default};
