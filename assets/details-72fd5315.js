import{j as e,$ as L,a0 as z,a1 as se,s as A,A as J,M as K,m as Q,n as X,p as Y,r as ee,q as U,ae}from"./chakra-594c63ee.js";import{c as N,j as C,d as T,y as w,z as S,A as y,ak as I,T as re,O as ie,ah as oe,v as te,t as D,N as W,q as le,al as q,n as F,D as M,aj as V,am as ce,an as de,ao as ue,ap as pe,p as $}from"./index-e60786d3.js";import{b as d}from"./react-2c0b8364.js";import{b as he}from"./graph-2e39fb85.js";import{s as H}from"./stations-1a2ef462.js";import{d as ge,e as me,f as fe}from"./change-types-3323b088.js";import{u as G,e as xe}from"./clipboard-9f294a85.js";import{m as ye}from"./misc-nodes-fd681017.js";function be(){const{t:s}=N(),r=C(),{selected:o,theme:c,paletteAppClip:{output:t}}=T(i=>i.runtime),n=d.useCallback(()=>{r(w()),r(S()),r(y(a.current.export()))},[r,w,S,y]),a=d.useRef(window.graph),g=i=>{if(a.current.hasNode(i)){const l=a.current.getNodeAttributes(i),f=l.type;return i.startsWith("stn")?l[f].names.join("/"):f}else if(a.current.hasEdge(i)){const[l,f]=a.current.extremities(i),h=a.current.getSourceAttributes(i),x=a.current.getTargetAttributes(i),j=h.type,v=x.type;return(l.startsWith("stn")?h[j].names[0]:j)+" - "+(f.startsWith("stn")?x[v].names[0]:v)}},m=i=>{o.forEach(l=>{if(a.current.hasEdge(l)){const f=a.current.getEdgeAttributes(l).style,h=a.current.getEdgeAttribute(l,f);f!==te.River&&h.color!==void 0&&(h.color=i),a.current.mergeEdgeAttributes(l,{[f]:h})}else if(a.current.hasNode(l)){const f=a.current.getNodeAttributes(l).type,h=a.current.getNodeAttribute(l,f);h.color!==void 0&&(h.color=i),a.current.mergeNodeAttributes(l,{[f]:h})}}),n()},[u,p]=d.useState(!1);return d.useEffect(()=>{u&&t&&(m(t),p(!1))},[t==null?void 0:t.toString()]),e.jsxs(L,{children:[e.jsxs(z,{as:"h5",size:"sm",children:[s("panel.details.selected")," ",o.length]}),e.jsx(I,{label:s("panel.details.multipleChangeColor"),children:e.jsx(re,{theme:c,onClick:()=>{p(!0),r(ie(c))}})}),e.jsx(se,{m:"var(--chakra-space-1)",children:o.map(i=>{var l;return e.jsx(A,{width:"100%",size:"sm",variant:"solid",onClick:()=>r(oe([i])),overflow:"hidden",maxW:"270",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:(l=g(i))==null?void 0:l.replaceAll("\\","⏎")},i)})})]})}function je(){const{t:s}=N(),r=C(),o=d.useCallback(()=>{r(S()),r(y(a.current.export()))},[r,S,y]),{selected:c,theme:t}=T(b=>b.runtime),n=c.at(0),a=d.useRef(window.graph),[g,m]=d.useState(!1),u=d.useRef(null),p=Object.fromEntries(Object.entries(D).map(([b,_])=>[b,s(_.metadata.displayName).toString()])),[i,l]=d.useState(a.current.getEdgeAttribute(n,"type")),[f,h]=d.useState(void 0),x=Object.fromEntries(Object.entries(W).map(([b,_])=>[b,s(_.metadata.displayName).toString()])),[j,v]=d.useState(a.current.getEdgeAttribute(n,"style")),[E,O]=d.useState(void 0),R=Object.values(le).filter(b=>!W[j].metadata.supportLinePathType.includes(b)),k=Object.values(te).filter(b=>!W[b].metadata.supportLinePathType.includes(i)),P=()=>{f&&(ge(a.current,n,f),l(a.current.getEdgeAttribute(n,"type")),o())},ne=()=>{E&&(me(a.current,n,E,t),v(a.current.getEdgeAttribute(n,"style")),o())},B=b=>{b&&(f?(P(),h(void 0)):E&&(ne(),O(void 0))),m(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(I,{label:s("panel.details.info.linePathType"),minW:"276",children:e.jsx(q,{options:p,disabledOptions:R,defaultValue:i,value:i,onChange:({target:{value:b}})=>{h(b),m(!0)}})}),e.jsx(I,{label:s("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(q,{options:x,disabledOptions:k,defaultValue:j,value:j,onChange:({target:{value:b}})=>{O(b),m(!0)}})}),e.jsx(J,{isOpen:g,leastDestructiveRef:u,onClose:()=>B(!1),children:e.jsx(K,{children:e.jsxs(Q,{children:[e.jsx(X,{children:s("warning")}),e.jsx(Y,{children:s("panel.details.changeLineTypeContent")}),e.jsxs(ee,{children:[e.jsx(A,{ref:u,onClick:()=>B(!1),children:s("cancel")}),e.jsx(A,{ml:"2",colorScheme:"red",onClick:()=>B(!0),children:s("panel.details.changeType")})]})]})})})]})}function Se(){const{t:s}=N(),r=C(),o=d.useCallback(()=>{r(w()),r(y(n.current.export()))},[r,w,y]),{selected:c}=T(x=>x.runtime),t=c.at(0),n=d.useRef(window.graph),[a,g]=d.useState(!1),m=d.useRef(null),[u,p]=d.useState(void 0),i=n.current.getNodeAttribute(t,"type"),l=Object.fromEntries(Object.entries(H).map(([x,j])=>[x,s(j.metadata.displayName).toString()])),f=()=>{u&&(fe(n.current,t,u),o())},h=x=>{x&&f(),p(void 0),g(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(I,{label:s("panel.details.info.stationType"),minW:"276",children:e.jsx(q,{options:l,disabledOptions:[i],value:i,onChange:({target:{value:x}})=>{p(x),g(!0)}})}),e.jsx(J,{isOpen:a,leastDestructiveRef:m,onClose:()=>h(!1),children:e.jsx(K,{children:e.jsxs(Q,{children:[e.jsx(X,{children:s("warning")}),e.jsx(Y,{children:s("panel.details.changeStationTypeContent")}),e.jsxs(ee,{children:[e.jsx(A,{ref:m,onClick:()=>h(!1),children:s("cancel")}),e.jsx(A,{ml:"2",colorScheme:"red",onClick:()=>h(!0),children:s("panel.details.changeType")})]})]})})})]})}function we(){const{t:s}=N(),r=C(),o=d.useCallback(()=>{r(w()),r(S()),r(y(n.current.export()))},[r,S,y]),{selected:c}=T(m=>m.runtime),t=c.at(0),n=d.useRef(window.graph),a=m=>{const u=Math.min(Math.max(m,-5),5);n.current.hasNode(t)&&n.current.setNodeAttribute(t,"zIndex",u),n.current.hasEdge(t)&&n.current.setEdgeAttribute(t,"zIndex",u),o()},g=[];return c.length===0||(c.length===1?(g.push({type:"input",label:s("panel.details.info.id"),value:t,minW:276}),g.push({type:"select",label:s("panel.details.info.zIndex"),value:t?n.current.hasNode(t)?n.current.getNodeAttribute(t,"zIndex"):n.current.hasEdge(t)?n.current.getEdgeAttribute(t,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:11},(m,u)=>[u-5,(u-5).toString()])),onChange:m=>a(Number(m))})):c.length>1&&g.push({type:"input",label:s("panel.details.info.type"),value:"multiple selection",minW:276})),e.jsxs(L,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:s("panel.details.info.title")}),e.jsx(F,{fields:g,minW:130}),c.length===1&&t.startsWith("stn")&&n.current.hasNode(t)&&n.current.getNodeAttribute(t,"type")in H&&e.jsx(Se,{}),c.length===1&&t.startsWith("line")&&n.current.hasEdge(t)&&n.current.getEdgeAttribute(t,"type")in D&&n.current.getEdgeAttribute(t,"style")in W&&e.jsx(je,{}),c.length>1&&e.jsx(be,{})]})}function Ae(){const{t:s}=N(),r=C(),{selected:o}=T(j=>j.runtime),c=o.at(0),t=d.useRef(window.graph),[n,a]=d.useState("undefined"),[g,m]=d.useState("undefined"),[u,p]=d.useState("undefined"),[i,l]=d.useState("undefined");d.useEffect(()=>{var j,v,E,O;if(c!=null&&c.startsWith("line")){const[R,k]=t.current.extremities(c);if(a(R),m(k),R.startsWith("stn")){const P=t.current.getNodeAttribute(R,"type");p((v=(j=t.current.getNodeAttribute(R,P))==null?void 0:j.names.at(0))!=null?v:"undefined")}if(k.startsWith("stn")){const P=t.current.getNodeAttribute(k,"type");l((O=(E=t.current.getNodeAttribute(k,P))==null?void 0:E.names.at(0))!=null?O:"undefined")}}},[o]);const f=G(()=>{r(M()),r(V(n))}),h=G(()=>{r(M()),r(V(g))}),x=[{type:"custom",label:s("panel.details.lineExtremities.source"),component:e.jsx(A,{flex:1,size:"sm",variant:"link",onClick:f,children:n}),minW:"full"},{type:"input",label:s("panel.details.lineExtremities.sourceName"),value:u,minW:"full"},{type:"custom",label:s("panel.details.lineExtremities.target"),component:e.jsx(A,{flex:1,size:"sm",variant:"link",onClick:h,children:g}),minW:"full"},{type:"input",label:s("panel.details.lineExtremities.targetName"),value:i,minW:"full"}];return e.jsxs(L,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:s("panel.details.lineExtremities.title")}),e.jsx(F,{fields:x,minW:130})]})}function Ne(){const{t:s}=N(),r=C(),o=d.useCallback(()=>{r(w()),r(S()),r(y(a.current.export()))},[r,w,S,y]),{selected:c,refresh:{nodes:t}}=T(p=>p.runtime),n=c.at(0),a=d.useRef(window.graph),[g,m]=d.useState({x:0,y:0});d.useEffect(()=>{if(n!=null&&n.startsWith("stn")||n!=null&&n.startsWith("misc_node_")){const p=a.current.getNodeAttribute(n,"x"),i=a.current.getNodeAttribute(n,"y");m({x:p,y:i})}},[t,c]);const u=[{type:"input",label:s("panel.details.nodePosition.pos.x"),value:g.x.toString(),validator:p=>!Number.isNaN(p),onChange:p=>{a.current.mergeNodeAttributes(n,{x:Number(p)}),o()}},{type:"input",label:s("panel.details.nodePosition.pos.y"),value:g.y.toString(),validator:p=>!Number.isNaN(p),onChange:p=>{a.current.mergeNodeAttributes(n,{y:Number(p)}),o()}}];return e.jsxs(L,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:s("panel.details.nodePosition.title")}),e.jsx(F,{fields:u,minW:130})]})}const Z={...H,...ye},Ce=()=>{var m;const s=C(),{selected:r}=T(u=>u.runtime),{t:o}=N(),c=r.at(0),t=window.graph.getNodeAttribute(c,"type"),n=t in Z&&Z[t].attrsComponent,a=(m=window.graph.getNodeAttribute(c,t))!=null?m:{},g=(u,p)=>{const i=window.graph.getNodeAttribute(u,"type");window.graph.mergeNodeAttributes(u,{[i]:p}),s(w()),s(y(window.graph.export()))};return n?e.jsx(n,{id:c,attrs:a,handleAttrsUpdate:g}):e.jsx(U,{fontSize:"xs",m:"var(--chakra-space-1)",children:o("panel.details.unknown.error",{category:o("panel.details.unknown.node")})})},Te=()=>{var l,f;const s=C(),{selected:r}=T(h=>h.runtime),{t:o}=N(),c=r.at(0),t=window.graph.getEdgeAttribute(c,"type"),n=(l=window.graph.getEdgeAttribute(c,t))!=null?l:{},a=t in D&&D[t].attrsComponent,g=window.graph.getEdgeAttribute(c,"style"),m=(f=window.graph.getEdgeAttribute(c,g))!=null?f:{},u=g in W&&W[g].attrsComponent,p=(h,x)=>{window.graph.mergeEdgeAttributes(h,{[t]:x}),s(S()),s(y(window.graph.export()))},i=(h,x)=>{window.graph.mergeEdgeAttributes(h,{[g]:x}),s(S()),s(y(window.graph.export()))};return e.jsxs(e.Fragment,{children:[a?e.jsx(a,{id:c,attrs:n,handleAttrsUpdate:p}):e.jsx(U,{fontSize:"xs",m:"var(--chakra-space-1)",children:o("panel.details.unknown.error",{category:o("panel.details.unknown.linePath")})}),u?e.jsx(u,{id:c,attrs:m,handleAttrsUpdate:i}):e.jsx(U,{fontSize:"xs",m:"var(--chakra-space-1)",children:o("panel.details.unknown.error",{category:o("panel.details.unknown.lineStyle")})})]})},ze=()=>{const{t:s}=N(),r=C(),o=d.useRef(window.graph),c=d.useCallback(()=>{r(w()),r(S()),r(y(o.current.export()))},[r,w,S,y]),{selected:t,mode:n}=T(i=>i.runtime),a=t.at(0),g=()=>r(M()),m=i=>{const l=structuredClone(o.current.getNodeAttributes(i));l.x+=50,l.y+=50;const f=i.startsWith("stn")?`stn_${$(10)}`:`misc_node_${$(10)}`;o.current.addNode(f,l),r(w()),r(y(o.current.export()))},u=i=>{const l=new Set(i),f=he(o.current,l),h=xe(o.current,l,new Set(f));navigator.clipboard.writeText(h)},p=i=>{r(M()),i.forEach(l=>{o.current.hasNode(l)?o.current.dropNode(l):o.current.hasEdge(l)&&o.current.dropEdge(l)}),c()};return e.jsxs(ce,{isOpen:t.length>0&&!n.startsWith("line"),width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(de,{onClose:g,children:s("panel.details.header")}),e.jsxs(ue,{children:[e.jsx(we,{}),t.length===1&&o.current.hasNode(a)&&e.jsx(Ne,{}),t.length===1&&o.current.hasEdge(a)&&e.jsx(Ae,{}),t.length===1&&e.jsxs(L,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:s("panel.details.specificAttrsTitle")}),window.graph.hasNode(a)&&e.jsx(Ce,{}),window.graph.hasEdge(a)&&e.jsx(Te,{})]})]}),e.jsx(pe,{children:e.jsxs(ae,{children:[t.length===1&&o.current.hasNode(t.at(0))&&e.jsx(A,{size:"sm",variant:"outline",onClick:()=>m(t.at(0)),children:s("panel.details.footer.duplicate")}),e.jsx(A,{size:"sm",variant:"outline",onClick:()=>u(t),children:s("panel.details.footer.copy")}),e.jsx(A,{size:"sm",variant:"outline",onClick:()=>p(t),children:s("panel.details.footer.remove")})]})})]})};export{ze as default};
